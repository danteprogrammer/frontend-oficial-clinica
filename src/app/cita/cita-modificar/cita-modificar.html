<div class="form-container">
    <div class="header">
        <h2>Modificar Cita</h2>
        <button class="btn-cancelar" (click)="cancelar()">← Volver al Listado</button>
    </div>

    <div *ngIf="mensajeExito" class="mensaje exito">{{ mensajeExito }}</div>
    <div *ngIf="mensajeError" class="mensaje error">{{ mensajeError }}</div>

    <form [formGroup]="modificarForm" (ngSubmit)="onSubmit()" *ngIf="citaOriginal && !cargando">
        <div class="form-grid">
            <!-- Paciente -->
            <div class="form-group">
                <label for="pacienteId">Paciente</label>
                <select id="pacienteId" formControlName="pacienteId" required>
                    <option value="">Seleccionar paciente</option>
                    <option *ngFor="let paciente of pacientes" [value]="paciente.idPaciente">
                        {{ paciente.nombres }} {{ paciente.apellidos }} - DNI: {{ paciente.dni }}
                    </option>
                </select>
            </div>

            <!-- Médico -->
            <div class="form-group">
                <label for="medicoId">Médico</label>
                <select id="medicoId" formControlName="medicoId" required>
                    <option value="">Seleccionar médico</option>
                    <option *ngFor="let medico of medicos" [value]="medico.idMedico">
                        Dr. {{ medico.nombres }} {{ medico.apellidos }}
                    </option>
                </select>
            </div>

            <!-- Tipo de Consulta -->
            <div class="form-group">
                <label>Tipo de Consulta</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" formControlName="tipoConsulta" value="paciente_nuevo">
                        Paciente nuevo
                    </label>
                    <label class="radio-label">
                        <input type="radio" formControlName="tipoConsulta" value="paciente_existente">
                        Paciente existente
                    </label>
                </div>
            </div>

            <!-- Seguro Médico -->
            <div class="form-group">
                <label>¿Cuenta con seguro médico?</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" formControlName="tieneSeguro" [value]="true">
                        Sí
                    </label>
                    <label class="radio-label">
                        <input type="radio" formControlName="tieneSeguro" [value]="false">
                        No
                    </label>
                </div>
            </div>

            <!-- Fecha de Cita -->
            <div class="form-group">
                <label for="fecha">Fecha de Cita</label>
                <input id="fecha" type="date" formControlName="fecha" [min]="getMinDate()" required>
            </div>

            <!-- Hora de Cita -->
            <div class="form-group">
                <label for="hora">Hora de Cita</label>
                <input id="hora" type="time" formControlName="hora" min="08:00" max="18:00" required>
            </div>

            <!-- Estado -->
            <div class="form-group">
                <label for="estado">Estado</label>
                <select id="estado" formControlName="estado" required>
                    <option value="Pendiente">Pendiente</option>
                    <option value="Confirmada">Confirmada</option>
                    <option value="EnProceso">En Proceso</option>
                    <option value="Completada">Completada</option>
                    <option value="Cancelada">Cancelada</option>
                </select>
            </div>

            <!-- Consultorio -->
            <div class="form-group">
                <label for="consultorioId">Consultorio</label>
                <select id="consultorioId" formControlName="consultorioId" required>
                    <option value="">Seleccionar consultorio</option>
                    <option *ngFor="let consultorio of consultorios" [value]="consultorio.idConsultorio">
                        {{ consultorio.numero }} - {{ consultorio.descripcion }}
                    </option>
                </select>
            </div>

            <!-- Motivo de la Cita -->
            <div class="form-group full-width">
                <label for="motivo">Motivo de la Cita</label>
                <textarea id="motivo" formControlName="motivo" rows="3"
                    placeholder="Describe brevemente el motivo de su cita" required></textarea>
            </div>

            <!-- Síntomas Principales -->
            <div class="form-group full-width">
                <label>Síntomas Principales (si aplica):</label>
                <div class="checkbox-group">
                    <label class="checkbox-label" *ngFor="let sintoma of sintomasDisponibles">
                        <input type="checkbox" [formControlName]="sintoma.id">
                        {{ sintoma.label }}
                    </label>
                </div>
            </div>

            <!-- Alérgico -->
            <div class="form-group">
                <label>Alérgico</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" formControlName="alergico" [value]="true">
                        Sí
                    </label>
                    <label class="radio-label">
                        <input type="radio" formControlName="alergico" [value]="false">
                        No
                    </label>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="button" class="btn-cancelar" (click)="cancelar()">
                Cancelar
            </button>
            <button type="submit" [disabled]="modificarForm.invalid || cargando" class="btn-registrar">
                {{ cargando ? 'Actualizando...' : 'Actualizar Cita' }}
            </button>
        </div>
    </form>

    <div *ngIf="cargando" class="loading">
        <p>Cargando información de la cita...</p>
    </div>
</div>
